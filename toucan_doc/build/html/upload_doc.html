<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Upload Tools Documentation &mdash; TOUCAN 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/toucan.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="TOUCAN 0.0.1 documentation" href="index.html" />
    <link rel="next" title="Django project presentation" href="django_project.html" />
    <link rel="prev" title="Models Documentation" href="models_doc.html" />
<link href='http://fonts.googleapis.com/css?family=Limelight' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="django_project.html" title="Django project presentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="models_doc.html" title="Models Documentation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">TOUCAN 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-ingest">
<span id="upload-tools-documentation"></span><h1>Upload Tools Documentation<a class="headerlink" href="#module-ingest" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="ingest.file_ok">
<tt class="descclassname">ingest.</tt><tt class="descname">file_ok</tt><big>(</big><em>line_1</em><big>)</big><a class="headerlink" href="#ingest.file_ok" title="Permalink to this definition">¶</a></dt>
<dd><p>check if the file is legit</p>
<p>to be modified, this function is not enough to check the integrity of the file given</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>line_1</strong> (<a class="reference external" href="http://docs.python.org/library/array.html#module-array" title="(in Python v2.7)"><em>array</em></a>) &#8211; first line of the csv file, only the header is checked</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ingest.get_campaign">
<tt class="descclassname">ingest.</tt><tt class="descname">get_campaign</tt><big>(</big><em>filename</em><big>)</big><a class="headerlink" href="#ingest.get_campaign" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the campaign name, and check to see if we already have this campaign in the database. Create new campaign if not.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>filename</strong> &#8211; Name of the file, which contains the campaign name</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the campaign object found or created</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ingest.get_deployment">
<tt class="descclassname">ingest.</tt><tt class="descname">get_deployment</tt><big>(</big><em>site</em>, <em>pi</em>, <em>campaign</em><big>)</big><a class="headerlink" href="#ingest.get_deployment" title="Permalink to this definition">¶</a></dt>
<dd><p>Check to see if we already have this deployment in the database. Create new deployment if not.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>site</strong> (<a class="reference external" href="http://docs.python.org/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; Name of the deployment site</li>
<li><strong>pi</strong> (<a class="reference external" href="http://docs.python.org/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; Name of the PI</li>
<li><strong>campaign</strong> (<em>Campaign</em>) &#8211; Campaign object this deployment is attached to</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the Deployment object found or created</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ingest.get_point">
<tt class="descclassname">ingest.</tt><tt class="descname">get_point</tt><big>(</big><em>data</em>, <em>dep_id</em><big>)</big><a class="headerlink" href="#ingest.get_point" title="Permalink to this definition">¶</a></dt>
<dd><p>Check to see if the current point has already been created. If so, return the point id. If not, create a new point.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To be regarded as the same point, <em>all</em> of the model&#8217;s fields (matchup_id, point, time_is, etc) must be the same.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>data</strong> (<a class="reference external" href="http://docs.python.org/library/array.html#module-array" title="(in Python v2.7)"><em>array</em></a>) &#8211; Data array containing the 10 field values</li>
<li><strong>dep_id</strong> (<em>integer</em>) &#8211; Id number of the deployment this point is attached to</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the point id of either the point that was found, or the new one created</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ingest.get_type">
<tt class="descclassname">ingest.</tt><tt class="descname">get_type</tt><big>(</big><em>string</em>, <em>radiometric</em><big>)</big><a class="headerlink" href="#ingest.get_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Read the measurement type from the string read, if it doesn&#8217;t exist, create it</p>
<p>Force the type to be lower case, so that we don&#8217;t get duplicates with just differences in case</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>string</strong> (<a class="reference external" href="http://docs.python.org/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; string containing the measurement type, i.e. in &#8220;Rho_wn_IS_412&#8221; the type is &#8220;Rho_wn_IS&#8221;</li>
<li><strong>radiometric</strong> (<em>boolean</em>) &#8211; true if the measurement is radiometric, meaning the string contains the wavelength</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ingest.get_wavelength">
<tt class="descclassname">ingest.</tt><tt class="descname">get_wavelength</tt><big>(</big><em>string</em><big>)</big><a class="headerlink" href="#ingest.get_wavelength" title="Permalink to this definition">¶</a></dt>
<dd><p>Read the measurement wavelength from the string, if it doesn&#8217;t exist, create it</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>string</strong> (<a class="reference external" href="http://docs.python.org/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; containing the wavelength, i.e. in &#8220;Rho_wn_IS_412&#8221; the type is &#8220;412&#8221;</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ingest.read_campaign_name">
<tt class="descclassname">ingest.</tt><tt class="descname">read_campaign_name</tt><big>(</big><em>filename</em><big>)</big><a class="headerlink" href="#ingest.read_campaign_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the name of the campaign from the name of the file (this function may should be rewritten or completed)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>filename</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; name of the file</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ingest.read_data">
<tt class="descclassname">ingest.</tt><tt class="descname">read_data</tt><big>(</big><em>file_data</em>, <em>instrument</em>, <em>filename</em><big>)</big><a class="headerlink" href="#ingest.read_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Function reading the file and uploading the data to the database</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>file_data</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#file" title="(in Python v2.7)"><em>file</em></a>) &#8211; file object to be read</li>
<li><strong>instrument</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) &#8211; id of the instrument used for the measurement</li>
<li><strong>filename</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; name of the file, the name of the campaign is extracted form it</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ingest.read_file">
<tt class="descclassname">ingest.</tt><tt class="descname">read_file</tt><big>(</big><em>file_data</em><big>)</big><a class="headerlink" href="#ingest.read_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an array (actually a list of lists) based on the uploaded data</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>file_data</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#file" title="(in Python v2.7)"><em>file</em></a>) &#8211; file object to be read</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ingest.units_and_name">
<tt class="descclassname">ingest.</tt><tt class="descname">units_and_name</tt><big>(</big><em>type</em><big>)</big><a class="headerlink" href="#ingest.units_and_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Using a dictionary, return the units and long name associate with a measurement type</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>type</strong> (<a class="reference external" href="http://docs.python.org/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; measurement type, as taken from the input spreadsheet headings</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">a dictionary with keys &#8220;units&#8221; and &#8220;long_name&#8221;. If the input type isn&#8217;t coded,
sets units = &#8220;NA&#8221; and long name = type</td>
</tr>
</tbody>
</table>
</dd></dl>

<span class="target" id="module-ingest_images"></span><dl class="class">
<dt id="ingest_images.IngestImages">
<em class="property">class </em><tt class="descclassname">ingest_images.</tt><tt class="descname">IngestImages</tt><big>(</big><em>inputdir</em>, <em>outdir</em><big>)</big><a class="headerlink" href="#ingest_images.IngestImages" title="Permalink to this definition">¶</a></dt>
<dd><p>Image ingestion class, with methods to do everything needed to ingest images
into the TOUCAN database</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>inputdir</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; Directory containing the input files</li>
<li><strong>outputdir</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; Top level archive directory to save geotiffs to
(region/instrument/year subdirectories will be automatically created)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ingest_images.IngestImages.add_to_database">
<tt class="descname">add_to_database</tt><big>(</big><big>)</big><a class="headerlink" href="#ingest_images.IngestImages.add_to_database" title="Permalink to this definition">¶</a></dt>
<dd><p>Add this image to the database</p>
<p>Create new instances of ImageRegion and/or Instrument as required, otherwise fetch existing ones.
Then add all the metadata to a new Image instance.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> (<a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; the data dictionary, as returned by <a class="reference internal" href="#ingest_images.IngestImages.read_data" title="ingest_images.IngestImages.read_data"><tt class="xref py py-meth docutils literal"><span class="pre">IngestImages.read_data()</span></tt></a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ingest_images.IngestImages.get_file_list">
<tt class="descname">get_file_list</tt><big>(</big><big>)</big><a class="headerlink" href="#ingest_images.IngestImages.get_file_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a list of all the metadata files in the specified directory.
Assumes metadata files have extension .json</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of metafiles</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ingest_images.IngestImages.ingest_all">
<tt class="descname">ingest_all</tt><big>(</big><big>)</big><a class="headerlink" href="#ingest_images.IngestImages.ingest_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Loop through all the metadata files in the given input directory and ingest all image files</p>
</dd></dl>

<dl class="method">
<dt id="ingest_images.IngestImages.ingest_image">
<tt class="descname">ingest_image</tt><big>(</big><em>thisfile</em><big>)</big><a class="headerlink" href="#ingest_images.IngestImages.ingest_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Ingest images from a single metafile. This method is called by ingest_all,
or it can be called manually to ingest one file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>thisfile</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; The metadata file for the image to be ingested (including full directory path)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ingest_images.IngestImages.make_quicklook">
<tt class="descname">make_quicklook</tt><big>(</big><big>)</big><a class="headerlink" href="#ingest_images.IngestImages.make_quicklook" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a jpg for quick checking of the data</p>
<p>Define reference wavelengths for R,G,B and pick out whichever instrument bands are closest to these.
Pull out the relevant data arrays, then normalise values to be between 0 and 1 (which plt.imshow needs).</p>
</dd></dl>

<dl class="method">
<dt id="ingest_images.IngestImages.read_data">
<tt class="descname">read_data</tt><big>(</big><big>)</big><a class="headerlink" href="#ingest_images.IngestImages.read_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Read in data from the data file (coordinates, and the parameters that were specified in the meta file). This
method is a wrapper to call various others depending on the file type</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Dictionary &#8220;data&#8221; holding all the data</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises IOError:</th><td class="field-body">if the requested instrument type is not coded</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ingest_images.IngestImages.read_meta_file">
<tt class="descname">read_meta_file</tt><big>(</big><big>)</big><a class="headerlink" href="#ingest_images.IngestImages.read_meta_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a JSON formatted metadata file (name in self.metafile), returning a dictionary</p>
</dd></dl>

<dl class="method">
<dt id="ingest_images.IngestImages.save_geotiff">
<tt class="descname">save_geotiff</tt><big>(</big><big>)</big><a class="headerlink" href="#ingest_images.IngestImages.save_geotiff" title="Permalink to this definition">¶</a></dt>
<dd><p>Save data to a geoTiff file, after creating appropriate directory structure</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> (<a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; the data dictionary for this file</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ingest_images.IngestImages.tidy_up">
<tt class="descname">tidy_up</tt><big>(</big><em>meta=False</em><big>)</big><a class="headerlink" href="#ingest_images.IngestImages.tidy_up" title="Permalink to this definition">¶</a></dt>
<dd><p>Move files to an &#8220;ingested&#8221; folder once they are processed, ready to be deleted later</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-ingest_images_file_readers"></span><dl class="class">
<dt id="ingest_images_file_readers.DataReaders">
<em class="property">class </em><tt class="descclassname">ingest_images_file_readers.</tt><tt class="descname">DataReaders</tt><a class="headerlink" href="#ingest_images_file_readers.DataReaders" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to hold all of our different readers for different instruments and filetypes</p>
<dl class="staticmethod">
<dt id="ingest_images_file_readers.DataReaders.aatsr_drift_apply">
<em class="property">static </em><tt class="descname">aatsr_drift_apply</tt><big>(</big><em>reflectance</em>, <em>band</em>, <em>acq_date</em><big>)</big><a class="headerlink" href="#ingest_images_file_readers.DataReaders.aatsr_drift_apply" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply drift correction to AATSR reflectance</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>reflectance</strong> &#8211; Array of the uncorrected reflectance values</li>
<li><strong>band</strong> &#8211; Index of this band (0-3)</li>
<li><strong>acq_date</strong> &#8211; Acquisition date of this image</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Array of drift corrected reflectance values</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="ingest_images_file_readers.DataReaders.aatsr_drift_remove">
<em class="property">static </em><tt class="descname">aatsr_drift_remove</tt><big>(</big><em>gc1</em>, <em>reflectance</em>, <em>band</em>, <em>acq_date</em><big>)</big><a class="headerlink" href="#ingest_images_file_readers.DataReaders.aatsr_drift_remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove drift correction from AATSR reflectance</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>gc1</strong> &#8211; Name of the GC1 file that was used</li>
<li><strong>reflectance</strong> &#8211; Array of reflectance for this band</li>
<li><strong>band</strong> &#8211; Index of this band (0-3)</li>
<li><strong>acq_date</strong> &#8211; Acquisition date for this image</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Array of reflectance with drift correction removed</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ingest_images_file_readers.DataReaders.correct_AATSR">
<tt class="descname">correct_AATSR</tt><big>(</big><em>image</em>, <em>metadata</em>, <em>data</em><big>)</big><a class="headerlink" href="#ingest_images_file_readers.DataReaders.correct_AATSR" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply corrections to AATSR reflectance and angles</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> &#8211; Open epr image object</li>
<li><strong>metadata</strong> &#8211; The metadata dictionary for this image</li>
<li><strong>data</strong> &#8211; Data dictionary of uncorrected data</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Updated data dictionary with corrected data</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="ingest_images_file_readers.DataReaders.correct_MERIS">
<em class="property">static </em><tt class="descname">correct_MERIS</tt><big>(</big><em>image</em>, <em>old_lon</em>, <em>old_lat</em>, <em>new_lon</em>, <em>new_lat</em>, <em>metadata</em>, <em>data</em><big>)</big><a class="headerlink" href="#ingest_images_file_readers.DataReaders.correct_MERIS" title="Permalink to this definition">¶</a></dt>
<dd><p>Correct MERIS TOA radiance according to solar irradiance model</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> &#8211; An open image file</li>
<li><strong>old_lon</strong> &#8211; Original longitude array (needed for regridding)</li>
<li><strong>old_lat</strong> &#8211; Original latitude array (needed for regridding)</li>
<li><strong>new_lon</strong> &#8211; New longitude array (needed for regridding)</li>
<li><strong>new_lat</strong> &#8211; New latitude array (needed for regridding)</li>
<li><strong>metadata</strong> &#8211; Image metadata dictionary</li>
<li><strong>data</strong> &#8211; Dictionary containing the data</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Data, with the reflectances corrected</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ingest_images_file_readers.DataReaders.read_aatsr">
<tt class="descname">read_aatsr</tt><big>(</big><em>ingest</em><big>)</big><a class="headerlink" href="#ingest_images_file_readers.DataReaders.read_aatsr" title="Permalink to this definition">¶</a></dt>
<dd><p>Read an AATSR file (.N1 format) and extract data for our region of interest</p>
<p>Default values are specified for variable names, wavelengths etc, but these can be overridden
by user if they are put in the json file. Default is to read Reflectance</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ingest</strong> &#8211; An IngestImages object instance, which contains metadata and inputdir variables</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Dictionary containing all the data arrays</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ingest_images_file_readers.DataReaders.read_hdf_gdal">
<tt class="descname">read_hdf_gdal</tt><big>(</big><em>ingest</em><big>)</big><a class="headerlink" href="#ingest_images_file_readers.DataReaders.read_hdf_gdal" title="Permalink to this definition">¶</a></dt>
<dd><p>Read an HDF format data file (eg VIIRS), using GDAL package</p>
<p>Extract the region of interest, and at the same time regrid to a regular grid.
Returns a dictionary containing the parameters that were requested in the metadata file
(plus coordinates) for the specified region.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ingest</strong> &#8211; An IngestImages object instance, which contains metadata and inputdir variables</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Dictionary containing the coordinates and data arrays</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The value of whichever variable was specified by ingest.metadata[&#8216;time_variable&#8217;].
This will be converted to a proper datetime in the calling method.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ingest_images_file_readers.DataReaders.read_meris">
<tt class="descname">read_meris</tt><big>(</big><em>ingest</em><big>)</big><a class="headerlink" href="#ingest_images_file_readers.DataReaders.read_meris" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a MERIS file (.N1 format) and extract data for our region of interest</p>
<p>Default values are specified for variable names, wavelengths etc, but these can be overridden
by user if they are put in the json file. Default is to read Radiance.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ingest</strong> &#8211; An IngestImages object instance, which contains metadata and inputdir variables</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Dictionary containing all the data arrays</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ingest_images_file_readers.DataReaders.read_n1">
<tt class="descname">read_n1</tt><big>(</big><em>ingest</em><big>)</big><a class="headerlink" href="#ingest_images_file_readers.DataReaders.read_n1" title="Permalink to this definition">¶</a></dt>
<dd><p>Read N1 file (eg MERIS or AATSR), using pyepr package</p>
<p>Extract the region of interest, and at the same time regrid to a regular grid.
Returns a dictionary containing the parameters that were requested in the metadata file
(plus coordinates) for the specified region.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ingest</strong> &#8211; An IngestImages object instance, which contains metadata and inputdir variables</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Dictionary containing the coordinates and data arrays</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The value of whichever variable was specified by ingest.metadata[&#8216;time_variable&#8217;].
This will be converted to a proper datetime in the calling method.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ingest_images_file_readers.DataReaders.read_viirs">
<tt class="descname">read_viirs</tt><big>(</big><em>ingest</em><big>)</big><a class="headerlink" href="#ingest_images_file_readers.DataReaders.read_viirs" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a VIIRS file (.hdf format) and extract data for our region of interest</p>
<p>Default values are specified for variable names, wavelengths etc, but these can be overridden
by user if they are put in the json file. Default is to read Reflectance</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ingest</strong> &#8211; An IngestImages object instance, which contains metadata and inputdir variables</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Dictionary containing all the data arrays</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<span class="target" id="module-ingest_images_geo_tools"></span><dl class="class">
<dt id="ingest_images_geo_tools.GeoTools">
<em class="property">class </em><tt class="descclassname">ingest_images_geo_tools.</tt><tt class="descname">GeoTools</tt><a class="headerlink" href="#ingest_images_geo_tools.GeoTools" title="Permalink to this definition">¶</a></dt>
<dd><p>Tools for geographic things - regridding, creating geotiff etc</p>
<dl class="staticmethod">
<dt id="ingest_images_geo_tools.GeoTools.array2raster">
<em class="property">static </em><tt class="descname">array2raster</tt><big>(</big><em>newRasterfn</em>, <em>rasterOrigin</em>, <em>pixelWidth</em>, <em>pixelHeight</em>, <em>data</em>, <em>variables</em>, <em>rotate=0</em><big>)</big><a class="headerlink" href="#ingest_images_geo_tools.GeoTools.array2raster" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert data dictionary (of arrays) into a multiband GeoTiff</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>newRasterfn</strong> &#8211; filename to save to</li>
<li><strong>rasterOrigin</strong> &#8211; location of top left corner</li>
<li><strong>pixelWidth</strong> &#8211; e-w pixel size</li>
<li><strong>pixelHeight</strong> &#8211; n-s pixel size</li>
<li><strong>data</strong> &#8211; dictionary containing the data arrays</li>
<li><strong>variables</strong> &#8211; list of which keys from the dictionary to output</li>
<li><strong>rotate</strong> &#8211; Optional rotation angle (in radians)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="ingest_images_geo_tools.GeoTools.extract_region_and_regrid">
<em class="property">static </em><tt class="descname">extract_region_and_regrid</tt><big>(</big><em>old_lon</em>, <em>old_lat</em>, <em>new_lon</em>, <em>new_lat</em>, <em>data</em><big>)</big><a class="headerlink" href="#ingest_images_geo_tools.GeoTools.extract_region_and_regrid" title="Permalink to this definition">¶</a></dt>
<dd><p>Re-grid data to a regular grid, at the same time as extracting the region of interest</p>
<p>Go through each point of the original grid, check if it is in the new grid, and if so append the 
data value to the closest grid point in the new grid.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Assumes that coordinates in the original satellite files are valid for the <em>centre</em> of the pixel, and that the
new coordinates are for the <em>edges</em> of the pixel (which is the GeoTiff convention).</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>old_lon</strong> &#8211; Longitude for the original grid (2d)</li>
<li><strong>old_lat</strong> &#8211; Latitude for the original grid (2d)</li>
<li><strong>new_lon</strong> &#8211; Longitude for the new grid (1d)</li>
<li><strong>new_lat</strong> &#8211; Latitude for the new grid (1d)</li>
<li><strong>data</strong> &#8211; 2d array of data to be regridded</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">array containing the mean value for each new grid point.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="ingest_images_geo_tools.GeoTools.get_new_lat_lon">
<em class="property">static </em><tt class="descname">get_new_lat_lon</tt><big>(</big><em>old_lon</em>, <em>old_lat</em>, <em>region</em><big>)</big><a class="headerlink" href="#ingest_images_geo_tools.GeoTools.get_new_lat_lon" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate new coordinate lists to use for regridding, such that the resolution is about the same as the old grid</p>
<p>When we just used adjacent lon and lat values to compute dx and dy, we sometimes still got holes. So use
opposite corners of squares made up from each group of four points instead:
ie. Rather than take dx as difference between 1A-2A, 2A-3A etc, we use 1A-2B, 2A-3B, etc
and for dy, use 2A-1B, 3A-2B etc:</p>
<div class="highlight-python"><div class="highlight"><pre>1A------2A------3A 
|       |       |  
1B------2B------3B 
|       |       |  
1C------2C------3C 
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ingest_images_geo_tools.GeoTools.latlon_distance_meters">
<tt class="descname">latlon_distance_meters</tt><big>(</big><em>lat</em>, <em>lon</em><big>)</big><a class="headerlink" href="#ingest_images_geo_tools.GeoTools.latlon_distance_meters" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the great circle distance between two points on the earth using the Haversine equation</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>lat</strong> &#8211; latitude pair in decimal degree as a list or scipy vec</li>
<li><strong>lon</strong> &#8211; longitude pair in decimal degree as a list or scipy vec</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/toucan.png" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="models_doc.html"
                        title="previous chapter">Models Documentation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="django_project.html"
                        title="next chapter">Django project presentation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/upload_doc.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="django_project.html" title="Django project presentation"
             >next</a> |</li>
        <li class="right" >
          <a href="models_doc.html" title="Models Documentation"
             >previous</a> |</li>
        <li><a href="index.html">TOUCAN 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, ARGANS Ltd.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>